<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kosta.finalproject.lego.mapper.SurveyMapper">

	<select id="getDays" resultType="org.kosta.finalproject.lego.vo.DaysVO">
      select * from days
   </select>
	<select id="getSkills" resultType="org.kosta.finalproject.lego.vo.SkillsVO">
      select * from skills
   </select>
	<select id="getTimes" resultType="org.kosta.finalproject.lego.vo.TimesVO">
      select * from times
   </select>
   
   <select id="findMasterList" resultType="org.kosta.finalproject.lego.vo.MasterVO">
   		select m.id,m.name, ms.career, ms.specifications
		from(
		select  distinct id
		from master_detail
		group by id, days_id, skills_id, times_id
		having 
		<foreach collection="skills" item="sk" open=" " close=" " separator=" or ">
			skills_id =#{sk}
		</foreach>
		<foreach collection="days" item="d" open=" or " close=" " separator=" or ">
		 days_id = #{d}
		 </foreach>
		 <foreach collection="times" item="ti" open=" or " close=" " separator=" or ">
		  times_id = #{ti}
		 </foreach> 
		  ) msd , member m, master ms
		where m.id = ms.id and m.id=msd.id and ms.category_no =#{categoryNo}
   </select>
   
   <select id="findMasterList2" resultType="org.kosta.finalproject.lego.vo.MasterVO">
   		select msd.id, m.name , ms.career, ms.specifications,category_no
		from(
			select  distinct id 
		from master
		group by id
		having 
		<foreach collection="id" item="id" open=" " close=" " separator=" or ">
			id =#{id}
		</foreach>
		) msd, member m, master ms
		where m.id = ms.id and m.id = msd.id and category_no = #{categoryNo}
   </select>
   	<select id="findMasterDetailList" resultType="org.kosta.finalproject.lego.vo.MasterVO">
   		select ms.id,ms.career,ms.category_no,ms.specifications, m.name 
   		from master ms, member m
   		where m.id=ms.id and ms.id =#{value}
   </select>
   
   <select id="findBookingDayByMasterId" resultType="org.kosta.finalproject.lego.vo.BookingVO">
   		select to_char(booking_day,'yyyy-fmmm-dd') as booking_day
		from booking
		where master_id = #{value}
   </select>
   
   <insert id="BookingToMaster" parameterType="org.kosta.finalproject.lego.vo.BookingVO">
   	insert into booking(booking_no,booking_content,booking_day,master_id,member_id) values(booking_no_seq.nextval,#{bookingContent},#{bookingDay},#{mdVO.id},#{mvo.id})
   
   </insert>
</mapper>